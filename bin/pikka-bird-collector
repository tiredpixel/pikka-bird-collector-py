#!/usr/bin/env python

import argparse
import logging
import os

import pikka_bird_collector.collector


defaults = {
    'command': 'collect',
    'log_level': 'INFO'}

parser = argparse.ArgumentParser(
    description="Pikka Bird monitoring tool Collector component.")

parser.add_argument('-c', '--command',
    metavar='COMMAND',
    choices=['collect'],
    default=defaults['command'],
    help="command (default: %(command)s)" % defaults)

parser.add_argument('--log-level',
    metavar='LOG_LEVEL',
    choices=['DEBUG', 'INFO', 'WARNING', 'ERROR', 'CRITICAL'],
    default=defaults['log_level'],
    help="log-level (default: %(log_level)s))" % defaults)

args = parser.parse_args()


logger = logging.getLogger(str(os.getpid()))

formatter = logging.Formatter(
    '[%(asctime)s] %(levelname)s -- %(name)s: %(message)s')

ch = logging.StreamHandler()
ch.setFormatter(formatter)

logger.setLevel(args.log_level)
logger.addHandler(ch)


if args.command == 'collect':
    logger.info("Pikka Bird Collector v%(v)s" % { 'v': pikka_bird_collector.__version__ })
    collector = pikka_bird_collector.collector.Collector(logger=logger)
    collector.collect()
